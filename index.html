<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SeedFarm Pro Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="//libtl.com/sdk.js" data-zone="10426674" data-sdk="show_10426674"></script>
    
    <script src="https://adsgram.ai/sdk-v1.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { 
            background-color: #0b1120; 
            color: #f8fafc; 
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
        }
        .nav-btn.active { color: #10b981; }
        .tab-content { display: none; animation: slideUp 0.3s ease-out; }
        .tab-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .emerald-glow { box-shadow: 0 0 20px rgba(16, 185, 129, 0.2); }
        .btn-active:active { transform: scale(0.96); }
        .ads-label { background: #ef4444; color: white; font-size: 7px; padding: 1px 4px; border-radius: 4px; position: absolute; top: 10px; right: 15px; font-weight: 800; }
    </style>
</head>
<body class="pb-32">

    <div class="p-6 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 bg-gradient-to-br from-emerald-400 to-green-700 rounded-2xl flex items-center justify-center shadow-lg">
                <i class="fas fa-seedling text-white text-xl"></i>
            </div>
            <div>
                <h2 id="displayUser" class="text-sm font-bold tracking-tight">@Loading...</h2>
                <div class="flex items-center gap-1.5">
                    <span class="text-[9px] bg-emerald-500/10 text-emerald-400 px-2 py-0.5 rounded font-black tracking-widest uppercase">Elite Level</span>
                </div>
            </div>
        </div>
        <div class="glass-card px-4 py-2 border-emerald-500/20 flex items-center gap-2">
            <i class="fas fa-coins text-yellow-500 text-xs"></i>
            <span id="top-balance" class="font-mono font-black text-emerald-400 text-sm">0</span>
        </div>
    </div>

    <main class="px-6">
        
        <div id="home" class="tab-content active space-y-6">
            <div class="glass-card p-8 text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 blur-3xl rounded-full"></div>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest mb-2">Current Points Balance</p>
                <h1 id="total-coin" class="text-5xl font-black text-white tracking-tighter">0</h1>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="glass-card p-5 border-l-4 border-emerald-500">
                    <p class="text-[9px] font-bold text-slate-500 uppercase">Production</p>
                    <p class="text-lg font-black text-emerald-400">Stable</p>
                </div>
                <div class="glass-card p-5 border-l-4 border-blue-500">
                    <p class="text-[9px] font-bold text-slate-500 uppercase">Rank</p>
                    <p class="text-lg font-black text-blue-400">#1,204</p>
                </div>
            </div>
        </div>

        <div id="farming" class="tab-content space-y-6">
            <div class="px-2">
                <div class="flex justify-between items-end mb-3">
                    <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Growth Progress</span>
                    <span class="text-emerald-400 font-mono font-bold text-xs"><span id="harvest-counter">0</span>/40</span>
                </div>
                <div class="h-4 w-full bg-slate-800 rounded-full border border-white/5 p-1 overflow-hidden">
                    <div id="harvest-bar" class="h-full bg-gradient-to-r from-emerald-500 to-green-300 rounded-full transition-all duration-1000"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="glass-card p-6 text-center relative border-t-2 border-emerald-500/30">
                    <span class="ads-label">ADS</span>
                    <div class="text-5xl mb-4 drop-shadow-2xl">üçå</div>
                    <p class="text-[10px] font-black uppercase text-slate-400">Banana Tree</p>
                    <button id="btn-harvest" onclick="triggerAd('HARVEST')" class="btn-active mt-4 w-full py-3 bg-emerald-500 text-black font-black text-[10px] rounded-xl uppercase emerald-glow">
                        Harvest 40
                    </button>
                </div>
                
                <div class="glass-card p-6 text-center border-dashed border-2 border-white/5 opacity-30">
                    <div class="text-5xl mb-4">üîí</div>
                    <p class="text-[10px] font-bold uppercase text-slate-500">Slot Locked</p>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button id="btn-daily" onclick="triggerAd('DAILY')" class="btn-active glass-card p-4 flex items-center justify-between relative overflow-hidden">
                    <span class="ads-label">ADS</span>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center text-blue-400">
                            <i class="fas fa-calendar-check text-sm"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-[10px] font-black uppercase">Daily Bonus</p>
                            <p id="timer-daily" class="text-[9px] text-blue-400 font-mono">READY TO CLAIM</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-[10px] text-slate-600"></i>
                </button>

                <button id="btn-hourly" onclick="triggerAd('HOURLY')" class="btn-active glass-card p-4 flex items-center justify-between relative">
                    <span class="ads-label">ADS</span>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center text-purple-400">
                            <i class="fas fa-bolt text-sm"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-[10px] font-black uppercase">Hourly Drop</p>
                            <p id="timer-hourly" class="text-[9px] text-purple-400 font-mono">READY TO CLAIM</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right text-[10px] text-slate-600"></i>
                </button>
            </div>
        </div>

        <div id="plan" class="tab-content space-y-4">
            <div class="glass-card p-8 text-center border-t-2 border-yellow-500/50">
                <div class="w-20 h-20 bg-yellow-500/10 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-crown text-yellow-500 text-3xl"></i>
                </div>
                <h2 class="text-xl font-black italic">PRO FARMER</h2>
                <p class="text-xs text-slate-400 mt-3 px-4 leading-relaxed">Nikmati hasil panen 2x lipat dan hilangkan semua iklan iklan popup.</p>
                <button class="mt-8 w-full py-4 bg-yellow-500 text-black rounded-2xl font-black text-xs uppercase tracking-widest">Upgrade - 199k Points</button>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-6 left-6 right-6 h-20 glass-card rounded-[30px] flex justify-around items-center z-50 border-white/10 shadow-2xl">
        <button onclick="showTab('home', this)" class="nav-btn active flex flex-col items-center gap-1.5 transition-all">
            <i class="fas fa-grid-2 text-xl"></i>
            <span class="text-[8px] font-black uppercase tracking-tighter">Dash</span>
        </button>
        <button onclick="showTab('farming', this)" class="nav-btn flex flex-col items-center gap-1.5 transition-all text-slate-500">
            <i class="fas fa-seedling text-xl"></i>
            <span class="text-[8px] font-black uppercase tracking-tighter">Farm</span>
        </button>
        <button onclick="showTab('plan', this)" class="nav-btn flex flex-col items-center gap-1.5 transition-all text-slate-500">
            <i class="fas fa-crown text-xl"></i>
            <span class="text-[8px] font-black uppercase tracking-tighter">VIP</span>
        </button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // Konfigurasi Firebase (Sudah Sesuai Screenshot)
        const firebaseConfig = {
            apiKey: "AIzaSyBA0XxekNCYuBJVqLFWKhJYbIyEv7SGcOc",
            authDomain: "cryptofarm-bd14a.firebaseapp.com",
            projectId: "cryptofarm-bd14a",
            storageBucket: "cryptofarm-bd14a.firebasestorage.app",
            messagingSenderId: "9701816366",
            appId: "1:9701816366:web:fd369290508596e27287bf"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe?.user?.id?.toString() || "7138574504";
        const userRef = doc(db, "users", userId);

        let lastDaily = 0, lastHourly = 0, harvestProgress = 40;

        async function loadData() {
            const snap = await getDoc(userRef);
            if(!snap.exists()) await setDoc(userRef, { balance: 0, lastDaily: 0, lastHourly: 0 });
            const d = snap.data();
            lastDaily = d.lastDaily || 0;
            lastHourly = d.lastHourly || 0;
            document.getElementById('displayUser').innerText = "@" + (tg.initDataUnsafe?.user?.username || "Guest User");
            document.getElementById('total-coin').innerText = Math.floor(d.balance || 0).toLocaleString();
            document.getElementById('top-balance').innerText = Math.floor(d.balance || 0).toLocaleString();
        }

        // FUNGSI UTAMA IKLAN (FOKUS MONETAG)
        window.triggerAd = (type) => {
            const now = Date.now();
            if(type === 'DAILY' && now - lastDaily < 86400000) return;
            if(type === 'HOURLY' && now - lastHourly < 3600000) return;
            if(type === 'HARVEST' && harvestProgress < 40) return;

            tg.showConfirm(`Tonton iklan untuk klaim hadiah ${type}?`, (ok) => {
                if(ok) {
                    // JALANKAN MONETAG DULU
                    if (typeof show_10426674 !== 'undefined') {
                        show_10426674().then(() => {
                            giveReward(type);
                        }).catch(() => {
                            tg.showAlert("Iklan gagal dimuat, silakan coba lagi.");
                        });
                    } else {
                        tg.showAlert("Provider iklan tidak tersedia.");
                    }
                }
            });
        };

        async function giveReward(type) {
            let amount = (type === 'DAILY') ? 100 : (type === 'HOURLY') ? 50 : 40;
            let update = { balance: increment(amount) };
            
            if(type === 'DAILY') update.lastDaily = Date.now();
            if(type === 'HOURLY') update.lastHourly = Date.now();
            if(type === 'HARVEST') harvestProgress = 0;

            await updateDoc(userRef, update);
            tg.showAlert(`Sukses! +${amount} koin ditambahkan.`);
            loadData();
        }

        // LOGIKA INTERFACE & TIMER
        setInterval(() => {
            if (harvestProgress < 40) harvestProgress += 0.1;
            document.getElementById('harvest-counter').innerText = Math.floor(harvestProgress);
            document.getElementById('harvest-bar').style.width = (harvestProgress / 40 * 100) + "%";
            
            const btnH = document.getElementById('btn-harvest');
            if (harvestProgress >= 40) {
                btnH.classList.remove('opacity-50', 'grayscale', 'cursor-not-allowed');
            } else {
                btnH.classList.add('opacity-50', 'grayscale', 'cursor-not-allowed');
            }

            updateTimerUI('DAILY', 'timer-daily', 'btn-daily', 86400000, lastDaily);
            updateTimerUI('HOURLY', 'timer-hourly', 'btn-hourly', 3600000, lastHourly);
        }, 1000);

        function updateTimerUI(type, textId, btnId, wait, last) {
            const el = document.getElementById(textId), btn = document.getElementById(btnId);
            const diff = Date.now() - last;
            if (diff < wait) {
                const rem = wait - diff;
                const h = Math.floor(rem/3600000), m = Math.floor((rem%3600000)/60000), s = Math.floor((rem%60000)/1000);
                el.innerText = `${h}h ${m}m ${s}s`;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                el.innerText = "READY TO CLAIM";
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        window.showTab = (id, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active', 'text-emerald-400'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.add('text-slate-500'));
            btn.classList.add('active', 'text-emerald-400');
            btn.classList.remove('text-slate-500');
        };

        tg.expand();
        loadData();
    </script>
</body>
</html>
